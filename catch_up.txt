Project summary
- Two-territory Mesa sim (East food-heavy, West wealth-heavy) with optional LM Studio control. Leaders choose fractional work allocations plus an infra-build flag; negotiations run each step when LLM is enabled; wages, morale, upkeep, and relation scoring drive survival.

Key files
- world_overview.md — Current high-level behaviour, turn order, heuristics, and tunable parameters (synced to code).
- main.py — CLI entry that builds WorldModel, steps the sim, saves logs, and prints summaries.
- src/model/world_model.py — Core wiring: phase orchestration (actions → negotiation → wages → upkeep → logging).
- src/model/economy.py — Wages/morale and population/upkeep helpers.
- src/model/diplomacy.py — Negotiation orchestration, trade clamping/classification, relation scoring/logging.
- src/model/log_utils.py — Console summary + chronicle appenders (ASCII bullets).
- src/model/llm_client.py — HTTP calls to LM Studio, using prompt_builder/parsers, with fallbacks.
- src/model/prompt_builder.py / src/model/parsers.py — Prompt assembly and JSON coercion/validation utilities.
- src/agents/leader.py — Leader/territory state, heuristic fallback, memory handling.
- src/agents/production.py — Work/production helpers used by LeaderAgent.
- config.py — All numeric knobs (starting resources, yields, infra costs/bonuses, wages/strike thresholds, population rules, seasons, rounding).
- output_log.txt — Most recent run output (what the user sees) with step-by-step actions, negotiations, wages, upkeep.

Design decisions, heuristics, quirks
- LLM-first control: valid JSON from LM Studio drives actions/negotiations; otherwise heuristic focuses on food until safe, then infra if affordable (<3), else wealth. Work shares clamp to [0,1] and normalise if >1.
- Negotiation: alternating dialogue + trade when LLM enabled every step; flows clamped to available resources and classified (gift/balanced/exploitative) to update shared relation score/label (-2..2). Current outputs skew to wealth gifts and sometimes malformed dialogue—prompt/validation needs tightening.
- Wages/morale: wage bill per worker = 0.1; unpaid debt accumulates, partial pay reduces debt, strike at 4 unpaid steps sets multiplier 0.5, otherwise morale floor 0.9.
- Seasons: spring→summer→autumn→winter, each lasting two ticks; food/wood multipliers 1.0/1.2/0.8/0.4.
- Refactor: economy/diplomacy/logging/prompt/parsing/production helpers extracted; world_model now orchestrates phases and reuses helpers; config_summary now matches config (wage 0.1, no unused “balanced” action). Console bullets in output logs were replaced with ASCII.

How to start a new session
- Open: world_overview.md, output_log.txt (latest run), next_time.md (if present for TODOs).
- Run: `cd C:\Users\micha\Documents\cmp400-emergent-culture` then `.venv\Scripts\activate` and `python main.py` (enter steps or accept default 25). Logs go to `logs/` with a per-run chronicle plus config_summary.txt.
- If testing LLM behaviour, ensure LM Studio is running at the configured endpoint (`config.LLMConfig.base_url`) or set `use_llm=False` when calling `run_demo`.
